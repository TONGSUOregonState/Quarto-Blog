---
title: "Quarto Basics"
format:
  html:
    code-fold: true
    css: styles.css
jupyter: python3
---

```{=html}
<div id="lock-overlay" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#fff;z-index:9999">
  <div style="max-width:340px;width:90%;border:1px solid #ddd;padding:16px;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.06);">
    <h3 style="margin:0 0 8px">Protected</h3>
    <p style="margin:0 0 8px">Enter password to view this page:</p>
    <input id="lock-pass" type="password" placeholder="Password" style="width:100%;padding:8px 10px;margin-bottom:8px">
    <button id="lock-btn" style="width:100%;padding:8px 10px;cursor:pointer">Unlock</button>
    <p id="lock-msg" style="color:#c00;font-size:0.9em;display:none;margin-top:8px">Wrong password</p>
  </div>
</div>
<script>
  const ok = "6c72b80ca39cd956c16d2fc662186f22"; 
  function md5(s){return CryptoJS.MD5(s).toString()}
  window.addEventListener('DOMContentLoaded', ()=>{
    const overlay=document.getElementById('lock-overlay');
    const input=document.getElementById('lock-pass');
    const btn=document.getElementById('lock-btn');
    const msg=document.getElementById('lock-msg');
    btn.onclick=()=>{ if(md5(input.value)===ok){ overlay.remove(); } else { msg.style.display='block'; } };
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/crypto-js.min.js"></script>
```

```{python}
#| label: fig-polar
#| fig-cap: "A line plot on a polar axis"
import numpy as np
import matplotlib.pyplot as plt

r = np.arange(0, 2, 0.01)
theta = 2 * np.pi * r
fig, ax = plt.subplots(subplot_kw={'projection': 'polar'})
ax.plot(theta, r)
ax.set_rticks([0.5, 1, 1.5, 2])
ax.grid(True)
plt.show()
```

```{=html}
<style>
/* è®© Cusdis è¯„è®ºåŒºå…¨å®½æ˜¾ç¤ºã€é¿å…å†…éƒ¨æ»šåŠ¨æ¡ */
#cusdis_thread,
#cusdis_thread iframe,
.cusdis,
.cusdis iframe {
  width: 100% !important;
  max-width: 100% !important;
  height: auto !important;
  min-height: 600px !important;
  overflow: visible !important;
}
#cusdis_thread { margin-top: 1.5rem; }
</style>

<div id="cusdis_thread"
  data-host="https://cusdis.com"
  data-app-id="8e84f4b9-8161-42da-8354-0d1b8c77f377"
  data-page-id="{{ page.path }}"
  data-page-url="{{ page.url }}"
  data-page-title="{{ page.title }}">
</div>
<script async defer src="https://cusdis.com/js/cusdis.es.js"></script>


<div id="like-box" style="margin:16px 0;display:flex;gap:10px;align-items:center">
  <button id="like-btn" style="padding:6px 12px;border:1px solid #ccc;border-radius:8px;cursor:pointer">
    ğŸ‘ +1
  </button>
  <span id="like-count" style="font-weight:600">0</span>
  <span id="like-hint" style="color:#666"></span>
</div>
```
```{=html}
<!-- ================== ç‚¹èµæ¨¡å— ================== -->
<div id="like-box" data-page-id="matlab-example1"
     style="margin: 16px 0; display: flex; gap: 10px; align-items: center;">
  <button id="like-btn" 
          style="padding: 8px 16px; border: 2px solid #3b82f6; border-radius: 8px; background: white; cursor: pointer; font-size: 16px; transition: all 0.2s;">
    ğŸ‘ ç‚¹èµ
  </button>
  <span id="like-count" style="font-weight: 600; font-size: 20px; color: #3b82f6;">0</span>
  <span id="like-hint" style="color: #666; font-size: 14px;"></span>
</div>

<script type="module">
  // ========== Supabase é…ç½®ä¿¡æ¯ ==========
  const SUPABASE_URL = "https://zvzsnuwxevmhzwivepbm.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2enNudXd4ZXZtaHp3aXZlcGJtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxMzkxMDgsImV4cCI6MjA3NTcxNTEwOH0.roiOOUn7lKOh0hgN2qpQFUSiSgTA2ZCY3i9LjJDTTu4";
  // =====================================

  // ä¼˜å…ˆè¯»å– HTML ä¸­å†™æ­»çš„ IDï¼ˆæœ€ç¨³å®šï¼‰
  function normalizedPageId() {
    const box = document.getElementById("like-box");
    const manual = box?.dataset?.pageId;
    if (manual && manual.trim()) return manual.trim();

    // å¤‡ç”¨æ–¹æ¡ˆï¼šURL è‡ªåŠ¨ç”Ÿæˆï¼ˆä»…ç”¨äºæ²¡å†™ data-page-id çš„æƒ…å†µï¼‰
    const url = new URL(location.href);
    const path = (url.pathname.replace(/\/+$/,'') || '/').toLowerCase();
    return `${url.host}${path}`;
  }
  const pageId = normalizedPageId();

  import("https://esm.sh/@supabase/supabase-js@2").then(async ({ createClient }) => {
    const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const btn = document.getElementById("like-btn");
    const out = document.getElementById("like-count");
    const hint = document.getElementById("like-hint");

    // è¯»å–ç‚¹èµæ•°
    async function loadCount() {
      const { data, error } = await sb
        .from("likes")
        .select("count")
        .eq("page_id", pageId)
        .maybeSingle();

      if (error) {
        console.error("åŠ è½½å¤±è´¥:", error);
        hint.textContent = "åŠ è½½å¤±è´¥";
        return;
      }
      out.textContent = data?.count ?? 0;
    }

    // è°ƒç”¨æ•°æ®åº“å‡½æ•°è‡ªå¢ç‚¹èµ
    async function incrementLike() {
      const { data, error } = await sb.rpc("like_inc", { pid: pageId });
      if (error) {
        console.error("ç‚¹èµå¤±è´¥:", error);
        return { error };
      }
      return { data: { count: data } };
    }

    // é˜²æ­¢å¹¶å‘ç‚¹å‡»
    let inflight = false;

    btn.addEventListener("click", async () => {
      if (inflight) return;
      inflight = true;
      btn.disabled = true;
      const prev = btn.textContent;
      btn.textContent = "ğŸ‘ æäº¤ä¸­...";

      // ä¹è§‚æ›´æ–°
      const optimistic = parseInt(out.textContent || "0", 10);
      out.textContent = String(optimistic + 1);

      const { data, error } = await incrementLike();

      if (error) {
        // å›æ»š
        out.textContent = String(Math.max(0, optimistic));
        hint.textContent = "ç‚¹èµå¤±è´¥ï¼Œè¯·é‡è¯•";
        btn.textContent = prev;
        btn.disabled = false;
        inflight = false;
        return;
      }

      // æ›´æ–°æ˜¾ç¤º
      out.textContent = data.count;
      btn.textContent = "ğŸ‘ ç‚¹èµ";
      hint.textContent = "æ„Ÿè°¢æ”¯æŒ â¤ï¸";
      btn.disabled = false;
      inflight = false;
    });

    // åˆå§‹åŒ–åŠ è½½
    await loadCount();
  }).catch(err => {
    console.error("åˆå§‹åŒ–å¤±è´¥:", err);
    document.getElementById("like-hint").textContent = "åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®";
  });
</script>



```